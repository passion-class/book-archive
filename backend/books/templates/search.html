
{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <link href="{% static 'books/css/search.css' %}" rel="stylesheet">
  <title>ì±… ê²€ìƒ‰ ë° ì„ íƒ ì €ì¥</title>
</head>
<body>
  <div class="background">
    <header>
      <ul class="navul">
        <li class="navlin"><a href="{% url 'users:info' %}" class="navlin">ë‚˜ì˜ ê³µê°„</a></li>
        <li class="navlin">|</li>
        <li class="navlin"><a href="{% url 'book:book_list' %}" class="navlin">ë‚´ ì„œì¬ë¡œ ...</a></li>
      </ul>
    </header>
    <h1>ì—¬ê¸°ëŠ” ë‹¹ì‹ ì˜ ì„œì¬,</h1>
    <p>ì–´ë–¤ ì±…ì„ ê°€ì§€ê³  ìˆëŠ”ì§€,<br>ì–´ë–¤ ì·¨í–¥ì„ ê°€ì§€ê³  ìˆëŠ”ì§€.</p>

    <h3>ğŸ“š ì±… ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš” ğŸ“š</h3>

    <!-- ğŸ” ê²€ìƒ‰ í¼ -->
    <form method="post">
      {% csrf_token %}
      <!-- <input type="text" name="title" id="id_title" placeholder="ìµœëŒ€í•œ ì •í™•í•˜ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”."> -->
      <!-- {{ form.as_p }} -->
      {{ form.title }}
      <button type="submit" name="search" class="but">ì±… ê²€ìƒ‰</button>
    </form>

    <!-- âœ… ê²€ìƒ‰ ê²°ê³¼ ìˆìœ¼ë©´ ì¶œë ¥ -->

      <hr>
      <h2>ê²€ìƒ‰ ê²°ê³¼</h2>

    <form method="post" action="{% url 'book:save_selected_books' %}">
        {% csrf_token %}
      <div class="con">
        {% for book in books %}
          <div class="searchlist">
            <table>
              <tbody>
                <tr>
                  <td><input type="checkbox" name="selected_books" value="{{ book.isbn }}"></td>
                </tr>
                <tr>
                  <td>{{ book.title }}</td>
                </tr>
                <tr>
                  <td>{{ book.authors }}</td>
                </tr>
                <tr>
                  <td>{{ book.publisher }} / {{ book.published_date }}</td>
                </tr>
                  {% if book.thumbnail %}
                <tr>
                  <td><img src="{{ book.thumbnail }}" width="100"></td>
                </tr>
                  {% endif %}
                <tr>
                  <td>{{ book.description|truncatechars:300 }}</td>
                </tr>
              </tbody>
            </table>
          </div> <!--searchlist-->
        {% endfor %}
      </div><!--con-->
        <input type="hidden" name="book_data_json" id="bookDataJson">
        <button type="submit" class="but">ì„œì¬ì— ì €ì¥</button>
    </form>
  </div> <!--background-->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        try {
          const rawJson = '{{ book_data_json|escapejs }}';
          const bookData = JSON.parse(rawJson);
          const input = document.getElementById("bookDataJson");
          input.value = JSON.stringify(bookData);
        } catch (e) {
          console.error("book_data_json ë Œë”ë§ ì˜¤ë¥˜:", e);
        }
      });
    </script>
    {% if messages %}
    <div class="toast-container">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <!-- <div class="rounded me-2" style="width: 20px; height: 20px;"></div> -->
                <!-- <div class="rounded me-2" style="width: 20px; height: 20px; background-color: #007aff;"></div> -->
                <!-- <img src="../books/images/totoro.jpg" class="rounded me-2" alt="..."> -->
                <img src="{% static 'books/images/totoro.jpg' %}" class="rounded me-2" alt="...">
                <strong class="me-auto">ì„œì¬ ê´€ë¦¬ì</strong>
                <small class="text-body-secondary">ì§€ê¸ˆ</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close">&times;</button>
            </div>
            <div class="toast-body">
                {% for message in messages %}
                    {{ message }}<br>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toastElement = document.getElementById('liveToast');
            if (toastElement) {
                // í† ìŠ¤íŠ¸ í‘œì‹œ
                toastElement.classList.add('show');
                
                // ë‹«ê¸° ë²„íŠ¼ ê¸°ëŠ¥
                const closeBtn = toastElement.querySelector('.btn-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function() {
                        toastElement.classList.remove('show');
                    });
                }
            }
        });
    </script>
</body>
</html>
